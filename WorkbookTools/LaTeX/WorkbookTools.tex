\documentclass{article}
\usepackage{kiwircs}
\usepackage{kiwibibtex,kiwimath,kiwitoc,verbatix}
\usepackage{xcolor,texnames}

\usepackage[colorlinks,citecolor=red]{hyperref}
\definecolor{gray}{gray}{0.5}
\begin{document}

\begin{package}{workbooktools.sty}

\begin{source}
\NeedsTeXFormat{LaTeX2e}
\RequirePackage{kiwircs}
\end{source}

\begin{source}
\RCS $Revision: 1.17 $
\RCS $Date: 2021-04-03 17:52:07+09 $
\end{source}

\begin{source}
\ProvidesPackage{workbooktools}[\RCSTeXDate\space v\RCSRevision\space Mahn-Soo Choi]
\end{source}

\begin{source}
\RequirePackage{currfile}
\end{source}

\parindent=0pt

\section{Math Cells}

\paragraph{loadMathBundle}

\begin{source}[mathbundle]
\newcounter{mathbundle}[subsection]
\end{source}

\begin{source}[\bundle@file]
\newcommand\bundle@file{%
  \currfilebase.nbc/\the\c@section.\the\c@subsection-\themathbundle.tex}
\end{source}

\begin{source}
\newif\ifIgnoreBundleLoadError
\IgnoreBundleLoadErrorfalse
\end{source}

Load the next bundle of Mathematica(R) cells.

\begin{source}[\loadMathBundle]
\newcommand\loadMathBundle{%
  \stepcounter{mathbundle}
  \IfFileExists{\bundle@file}{%
    \input{\bundle@file}}{%
    \PackageWarning{workbooktools}{Bundle file \bundle@file\space not found}
    \ifIgnoreBundleLoadError\else{\textcolor{red}{\fbox{\bundle@file}}}\fi}}
\end{source}

Skip the next bundle of Mathematica(R) cells.

\begin{source}[\skipMathBundle]
\newcommand\skipMathBundle{\stepcounter{mathbundle}}
\end{source}

\paragraph{mathbundle}

\begin{source}[mathbundle]
\newenvironment{mathbundle}{%
  \begin{list}{}{
    \parskip=6pt plus 4pt
    \topsep=6pt plus 4pt
    \partopsep=0pt plus 4pt
    \itemsep=6pt plus 4pt
    \parsep=0pt plus 4pt
  }%
  \raggedleft}{%
  \end{list}}
\end{source}

\begin{source}[\includemathcell]
\newcommand\includemathcell[1]{%
  \item\relax\includegraphics[scale=\mathcellscale]{#1}}
\end{source}

\begin{source}[\mathcellscale]
\newcommand\mathcellscale{0.72}
\end{source}

\section{Title}

Borrowed from \name{svmono} provided by Springer.

\begin{source}[\maketitle]
\def\maketitle{\par
 \begingroup
   \def\thefootnote{\fnsymbol{footnote}}%
   \def\@makefnmark{\hbox
       to\z@{$\m@th^{\@thefnmark}$\hss}}%
   \if@twocolumn
     \twocolumn[\@maketitle]%
     \else \newpage
     \global\@topnum\z@   % Prevents figures from going at top of page.
     \@maketitle \fi\thispagestyle{empty}\@thanks
     \par\penalty -\@M
 \endgroup
 \setcounter{footnote}{0}%
 \let\maketitle\relax
 \let\@maketitle\relax
 \gdef\@thanks{}\gdef\@author{}\gdef\@title{}\let\thanks\relax}
\end{source}

\begin{source}[\@maketitle]
\def\@maketitle{\newpage
 \null
 \vskip 2em                 % Vertical space above title.
\begingroup
  \def\and{\unskip, }
  \parindent=\z@
  \pretolerance=10000
  \rightskip=\z@ \@plus 3cm
  {\LARGE                   % each author set in \LARGE
   \lineskip .5em
   \textbf{\@author}
   \par}%
  \vskip 2cm                % Vertical space after author.
  {\Huge \textbf{\@title} \par}%     % Title set in \Huge size.
  \vskip 1cm                % Vertical space after title.
  \if!\@subtitle!\else
   {\LARGE\ignorespaces\@subtitle \par}
   \vskip 1cm                % Vertical space after subtitle.
  \fi
  \if!\@date!\else
    {\large \@date}%          % Date set in \large size.
    \par
    \vskip 1.5em               % Vertical space after date.
  \fi
 \vfill
 {\Large Springer\par}
%\vskip 5\p@
%\large
%  Berlin\enspace Heidelberg\enspace New\kern0.1em York\\
%  Hong\thinspace Kong\enspace London\\
%  Milan\enspace Paris\enspace Tokyo\par
\endgroup}
\end{source}

\begin{source}[\subtitle]
\def\subtitle#1{\gdef\@subtitle{#1}}
\end{source}

\begin{source}[\@subtitle]
\def\@subtitle{}
\end{source}


\section{Prelude}

\begin{verbatim}[prelude]
\newenvironment{prelude}[1][\@empty]{%
  \begin{@prelude}
  \ifx\@empty#1\else\item[]\relax\footnotesize\hfill\textbf{#1}\fi
}{\end{@prelude}}
\end{verbatim}

\begin{verbatim}[@prelude]
\newenvironment{@prelude}{% opening part
  \begin{list}{$\bullet$}{%
    \def\fakelabel##1{\textbf{##1}\hfill }%
    \let\makelabel\fakelabel%
    \leftmargin=0.5\linewidth\rightmargin=0pt%
    \topsep=0pt\itemsep=0pt\parsep=0pt%
    \labelwidth=1ex\labelsep=.75ex%
    \footnotesize}
}{% closing part
  \end{list}\par
  % \global\noindent@once
  \@afterheading
  \@checkend{@prelude}
}
\end{verbatim}

\section{Bibliography}

\begin{verbatim}[\doi]
\newcommand{\doi}[2][\empty]{%
  \href{https://doi.org/#2}{\ifx#1\empty\nolinkurl{#2}\else#1\fi}}
\end{verbatim}

\begin{verbatim}[\arxiv]
\newcommand{\arxiv}[2][\empty]{%
  \href{http://arxiv.org/abs/#2}{\ifx#1\empty\nolinkurl{#2}\else#1\fi}}
\end{verbatim}


\section{Index}

\begin{source}
\AtEndDocument{%
  \phantomsection% required for hyperref package
  \addcontentsline{toc}{chapter}{Index}%
  \printindex}
\end{source}


\section{Others}

\begin{source}
\endinput
\end{source}
\end{package}


\end{document}
