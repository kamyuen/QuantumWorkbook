(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 13.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     34235,        880]
NotebookOptionsPosition[     26067,        691]
NotebookOutlinePosition[     28202,        761]
CellTagsIndexPosition[     28159,        758]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Controlled Power", "Title",
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGAQAWIQfWLmXM6kT28cvfy0uUC0Hl9r9kIgXZW4Akw39fuz
LgLSPm4T2UD0g9KzO3eB5AszdoHoV89bDC4A6c9WgYYgeoOuSpDA5zeOXd5/
wHRFTPFvYSB9qrUcTG+4zPRKC0i/lV4AptmUkuwrf79x7Eu5BqbdHu+c9PLP
G0ffRUmTQXTD0Yx99v/eOH6w/wKm4x6yRt4B0gz3fcH0iY5vid3/3zj2VPwC
029Xnf7xBkgftxH/CaJ13rO1yPG+dczRMwfTUb7GK+SB9IzXW8B0XXr+LwUg
/Vra/TeIvvdNrVQJSItVvwfTm2ccWgqiGTkUl4Fotywujlitt45xc/zBNAC+
ZqyV
  "],
 CellID->1984307302,ExpressionUUID->"e4483668-5de3-417a-8cd7-aebbcc4e7409"],

Cell["Episodes 17 and 19. ControlledGate", "Text",
 CellChangeTimes->{{3.89924916799488*^9, 3.899249207303158*^9}, {
  3.899249293468512*^9, 3.899249302315398*^9}, {3.914524745859529*^9, 
  3.914524751513803*^9}, {3.914543155827255*^9, 3.914543162916451*^9}},
 CellID->1381245641,ExpressionUUID->"24eab5e8-b68c-4233-936a-9b37f57105f4"],

Cell["Episode 34. ControlledPower", "Text",
 CellChangeTimes->{{3.89924916799488*^9, 3.899249207303158*^9}, {
  3.899249293468512*^9, 3.899249330506671*^9}, {3.914543168710368*^9, 
  3.914543174755287*^9}},
 FontWeight->"Bold",
 CellID->1422026746,ExpressionUUID->"c9f07fa4-664a-4afc-92d9-b3f807628f6e"],

Cell["Episode 35. Quantum Phase Estimation: Principle", "Text",
 CellChangeTimes->{{3.89924916799488*^9, 3.899249207303158*^9}, {
  3.899249293468512*^9, 3.899249302315398*^9}, {3.914524745859529*^9, 
  3.914524751513803*^9}, {3.914543155827255*^9, 3.914543162916451*^9}, {
  3.9155618163634644`*^9, 3.9155618583050337`*^9}},
 CellID->1339111300,ExpressionUUID->"7e0aaf01-7ef4-4c0f-85e1-6877598ac84f"],

Cell["Episode 36. Quantum Phase Estimation: Implementation", "Text",
 CellChangeTimes->{{3.89924916799488*^9, 3.899249207303158*^9}, {
  3.899249293468512*^9, 3.899249302315398*^9}, {3.914524745859529*^9, 
  3.914524751513803*^9}, {3.914543155827255*^9, 3.914543162916451*^9}, {
  3.9155618163634644`*^9, 3.91556188239434*^9}},
 CellID->1132394223,ExpressionUUID->"9228c48e-323f-4f58-a570-5553cbe8867f"],

Cell[CellGroupData[{

Cell["What is it?", "Section",
 CellChangeTimes->{{3.850951367901561*^9, 3.850951375932513*^9}, {
  3.914543136969301*^9, 3.914543138558337*^9}},
 CellID->3657172,ExpressionUUID->"befd37cb-180c-410b-b536-822b7d960c18"],

Cell[TextData[{
 "The controlled-power of unitary operator ",
 Cell[BoxData[
  FormBox["U", TraditionalForm]],ExpressionUUID->
  "3c9043e4-e930-4145-93b7-73ff87d9ca33"],
 " is given by"
}], "Text",
 CellChangeTimes->{{3.914540787677719*^9, 3.9145408113155003`*^9}},
 CellID->307202916,ExpressionUUID->"773fc0f0-05d7-465f-9683-8df09c854ece"],

Cell[CellGroupData[{

Cell[TextData[{
 "\t",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{
     TemplateBox[{
       RowBox[{
         SubscriptBox["x", "1"], 
         SubscriptBox["x", "2"], "\[Ellipsis]", "\[VeryThinSpace]", 
         SubscriptBox["x", "n"]}]},
      "Ket"], "\[CircleTimes]", 
     TemplateBox[{"\[Psi]"},
      "Ket"]}], "\[RightTeeArrow]", 
    RowBox[{
     TemplateBox[{
       RowBox[{
         SubscriptBox["x", "1"], 
         SubscriptBox["x", "2"], "\[Ellipsis]", "\[VeryThinSpace]", 
         SubscriptBox["x", "n"]}]},
      "Ket"], "\[CircleTimes]", 
     RowBox[{"(", 
      RowBox[{
       SuperscriptBox[
        StyleBox["U",
         FontSlant->"Italic"], "x"], 
       TemplateBox[{"\[Psi]"},
        "Ket"]}], ")"}]}]}], TraditionalForm]],ExpressionUUID->
  "683cf35a-d7ba-4767-ba22-fe6ac7d30724"],
 " ,"
}], "Caption",
 CellChangeTimes->{{3.914540535172536*^9, 3.91454076908256*^9}, 
   3.914540812589497*^9},
 CellID->485030944,ExpressionUUID->"0583174a-f550-4c6f-aeac-a4c0e03f6fcc"],

Cell[TextData[{
 "where ",
 Cell[BoxData[
  FormBox[
   RowBox[{"x", ":=", 
    RowBox[{
     SubscriptBox[
      RowBox[{"(", 
       RowBox[{
        SubscriptBox["x", "1"], 
        SubscriptBox["x", "2"], 
        SubscriptBox["\[Ellipsis]x", "n"]}], ")"}], "2"], "=", 
     RowBox[{
      RowBox[{
       SubscriptBox["x", "1"], 
       SuperscriptBox["2", 
        RowBox[{"n", "-", "1"}]]}], "+", 
      RowBox[{
       SubscriptBox["x", "2"], 
       SuperscriptBox["2", 
        RowBox[{"n", "-", "2"}]]}], "+", "\[Ellipsis]", "+", 
      SubscriptBox["x", "n"]}]}]}], TraditionalForm]],ExpressionUUID->
  "5ae60f62-04a7-4f33-8b62-e1dbd707defc"],
 "."
}], "Caption",
 CellChangeTimes->{{3.914540535172536*^9, 3.914540751802066*^9}},
 CellID->1703606369,ExpressionUUID->"169c502a-5762-43c2-92bb-a57bfecd9a0d"]
}, Open  ]],

Cell[TextData[{
 "\t",
 Cell[BoxData[
  InterpretationBox[
   GraphicsBox[{
     {Dashing[{Small, Small}], LineBox[{}]}, 
     LineBox[{{{0, -1}, {2, -1}}, {{0, -2}, {2, -2}}, {{0, -3}, {2, -3}}, {{
      0, -5}, {2, -5}}}], {{InsetBox[
        StyleBox[
         TemplateBox[{
           FormBox[
            InterpretationBox[
             SubscriptBox["x", 
              TemplateBox[{",", "\",\"", "1"}, "RowWithSeparators"]], 
             $CellContext`x[1]], TraditionalForm]},
          "Ket"],
         StripOnInput->False,
         FontSize->Scaled[0.16000000000000003`],
         FontWeight->"Light"], {-0.1, -1}, NCache[
        ImageScaled[{1, Rational[1, 2]}], ImageScaled[{1, 0.5}]]], InsetBox[
        StyleBox[
         TemplateBox[{
           FormBox[
            InterpretationBox[
             SubscriptBox["x", 
              TemplateBox[{",", "\",\"", "2"}, "RowWithSeparators"]], 
             $CellContext`x[2]], TraditionalForm]},
          "Ket"],
         StripOnInput->False,
         FontSize->Scaled[0.16000000000000003`],
         FontWeight->"Light"], {-0.1, -2}, NCache[
        ImageScaled[{1, Rational[1, 2]}], ImageScaled[{1, 0.5}]]], InsetBox[
        StyleBox[
         TemplateBox[{
           FormBox[
            InterpretationBox[
             SubscriptBox["x", 
              TemplateBox[{",", "\",\"", "3"}, "RowWithSeparators"]], 
             $CellContext`x[3]], TraditionalForm]},
          "Ket"],
         StripOnInput->False,
         FontSize->Scaled[0.16000000000000003`],
         FontWeight->"Light"], {-0.1, -3}, NCache[
        ImageScaled[{1, Rational[1, 2]}], ImageScaled[{1, 0.5}]]]}, InsetBox[
       StyleBox[
        TemplateBox[{
          TemplateBox[{"\"\[Psi]\""}, "Ket"], "\" \""},
         "RowDefault"],
        StripOnInput->False,
        FontSize->Scaled[0.16000000000000003`],
        FontWeight->"Light"], {-0.1, -5}, NCache[
       ImageScaled[{1, Rational[1, 2]}], ImageScaled[{1, 0.5}]]]}, {
      LineBox[{{1, -1}, {1, -2}, {1, -3}, {1, -5}}], 
      {GrayLevel[1], EdgeForm[Opacity[1]], 
       RectangleBox[{0.6, -3.4}, {1.4, -0.6},
        RoundingRadius->0.4]}, InsetBox[
       StyleBox["\<\"x\"\>",
        StripOnInput->False,
        FontSize->Scaled[0.2],
        FontWeight->"Light",
        FontSlant->Italic], {1, -2}, NCache[
       ImageScaled[{Rational[1, 2], Rational[1, 2]}], 
        ImageScaled[{0.5, 0.5}]]], 
      {GrayLevel[1], EdgeForm[Opacity[1]], 
       RectangleBox[{0.6, -5.4}, {1.4, -4.6}]}, InsetBox[
       StyleBox[
        TemplateBox[{"\"U\"", "\"x\""},
         "Superscript"],
        StripOnInput->False,
        FontSize->Scaled[0.2],
        FontWeight->"Light",
        FontSlant->Italic], {1, -5}, NCache[
       ImageScaled[{Rational[1, 2], Rational[1, 2]}], 
        ImageScaled[{0.5, 0.5}]]]}, InsetBox[
      StyleBox[
       TemplateBox[{
         StyleBox[
          
          TemplateBox[{"\"U\"", "\"x\""}, "Superscript", SyntaxForm -> 
           SuperscriptBox], Italic, StripOnInput -> False], 
         TemplateBox[{"\"\[Psi]\""}, "Ket"]},
        "RowDefault"],
       StripOnInput->False,
       FontSize->Scaled[0.16000000000000003`],
       FontWeight->"Light"], {2.1, -5}, NCache[
      ImageScaled[{0, Rational[1, 2]}], ImageScaled[{0, 0.5}]]]},
    AxesStyle->Large,
    FrameStyle->Large,
    ImagePadding->{{36, 54.}, {1, 1}},
    ImageSize->162.,
    PlotRange->NCache[{Full, {
        Rational[-11, 2], 
        Rational[-1, 2]}}, {Full, {-5.5, -0.5}}],
    PlotRangePadding->Scaled[0.025]],
   Q3`QuantumCircuit[
    Q3`QuantumCircuitIn[
     Ket[<|$CellContext`S[1, Q3`$] -> $CellContext`x[1], $CellContext`S[
        2, Q3`$] -> $CellContext`x[2], $CellContext`S[
        3, Q3`$] -> $CellContext`x[3]|>], 
     Q3`ProductState[<|$CellContext`T[Q3`$] -> {1, 1}|>, "Label" -> Row[{
         Ket[{"\[Psi]"}], " "}]]], 
    Q3`ControlledPower[{
      $CellContext`S[1, Q3`$], 
      $CellContext`S[2, Q3`$], 
      $CellContext`S[3, Q3`$]}, 
     Rational[1, 2] (1 + E^(Complex[0, 1] $CellContext`\[Phi])) + 
     Rational[1, 2] (1 - 
       E^(Complex[0, 1] $CellContext`\[Phi])) $CellContext`T[1]], 
    Q3`QuantumCircuitOut[
     Q3`ProductState[<|$CellContext`T[Q3`$] -> {1, 1}|>, "Label" -> Row[{
         Style[
          Superscript["U", "x"], Italic], 
         Ket[{"\[Psi]"}]}]]], "PortSize" -> {1, 1.5}, "Invisible" -> {
      $CellContext`S[3.5]}]]],ExpressionUUID->
  "427ff58d-ee15-45ce-a5f9-a43f20f16729"]
}], "Text",
 CellChangeTimes->{
  3.914540454389618*^9, {3.914540518908263*^9, 3.914540520579034*^9}, 
   3.914540587039541*^9, {3.91454084657739*^9, 3.914540847559824*^9}},
 CellID->1046697982,ExpressionUUID->"477ebf39-4d0f-4f6c-bc18-49c0e3f83c65"],

Cell[TextData[{
 StyleBox["Figure 1",
  FontWeight->"Bold"],
 ". Quantum circuit for the controlled-power of unitary ",
 Cell[BoxData[
  FormBox["U", TraditionalForm]],ExpressionUUID->
  "9f754582-ff00-4df6-9dda-59f8e8ba3c03"],
 ", ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{
     TemplateBox[{
       RowBox[{
         SubscriptBox["x", "1"], 
         SubscriptBox["x", "2"], "\[Ellipsis]", "\[VeryThinSpace]", 
         SubscriptBox["x", "n"]}]},
      "Ket"], "\[CircleTimes]", 
     TemplateBox[{"\[Psi]"},
      "Ket"]}], "\[RightTeeArrow]", 
    RowBox[{
     TemplateBox[{
       RowBox[{
         SubscriptBox["x", "1"], 
         SubscriptBox["x", "2"], "\[Ellipsis]", "\[VeryThinSpace]", 
         SubscriptBox["x", "n"]}]},
      "Ket"], "\[CircleTimes]", 
     RowBox[{"(", 
      RowBox[{
       SuperscriptBox[
        StyleBox["U",
         FontSlant->"Italic"], "x"], 
       TemplateBox[{"\[Psi]"},
        "Ket"]}], ")"}]}]}], TraditionalForm]],ExpressionUUID->
  "4a12a0fe-60d0-494d-a39b-5b5203bdfcf3"],
 ", where ",
 Cell[BoxData[
  FormBox[
   RowBox[{"x", ":=", 
    RowBox[{
     SubscriptBox[
      RowBox[{"(", 
       RowBox[{
        SubscriptBox["x", "1"], 
        SubscriptBox["x", "2"], 
        SubscriptBox["\[Ellipsis]x", "n"]}], ")"}], "2"], "=", 
     RowBox[{
      RowBox[{
       SubscriptBox["x", "1"], 
       SuperscriptBox["2", 
        RowBox[{"n", "-", "1"}]]}], "+", 
      RowBox[{
       SubscriptBox["x", "2"], 
       SuperscriptBox["2", 
        RowBox[{"n", "-", "2"}]]}], "+", "\[Ellipsis]", "+", 
      SubscriptBox["x", "n"]}]}]}], TraditionalForm]],ExpressionUUID->
  "75edb5f4-e555-40f4-b056-38d909ae3475"],
 "."
}], "Caption",
 CellChangeTimes->{{3.914540535172536*^9, 3.914540723131487*^9}, {
  3.9145407775625772`*^9, 3.91454077824433*^9}},
 CellID->754200099,ExpressionUUID->"8716361a-3e43-418a-bec3-5a740c0bb627"]
}, Closed]],

Cell[CellGroupData[{

Cell["Basic Example", "Section",
 CellChangeTimes->{{3.914543130530189*^9, 3.914543132793051*^9}, {
  3.914543598042987*^9, 3.914543620268611*^9}, {3.914543853879024*^9, 
  3.914543854378989*^9}},
 CellID->1332143281,ExpressionUUID->"5300a201-7c23-4ffb-83ac-5823c63c4696"],

Cell[BoxData[
 RowBox[{"Let", "[", 
  RowBox[{"Qubit", ",", "S", ",", "T"}], "]"}]], "Input",
 CellChangeTimes->{{3.914543206280628*^9, 3.914543208497357*^9}, {
  3.914543291000174*^9, 3.914543298101079*^9}},
 CellLabel->"In[39]:=",
 CellID->1535052485,ExpressionUUID->"6fc1aab9-96b9-46d1-a229-49e33d1e31ed"],

Cell[TextData[{
 "Consider a control register consisting of ",
 Cell[BoxData[
  FormBox["n", TraditionalForm]],ExpressionUUID->
  "ad5bdb97-c805-4945-98eb-f7f9539a27a5"],
 " qubits."
}], "Text",
 CellChangeTimes->{{3.915562097848004*^9, 3.915562113851685*^9}},
 CellID->1475887768,ExpressionUUID->"8107f988-2779-4f9f-8e16-a7ef570fa3af"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"$n", "=", "3"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"kk", "=", 
   RowBox[{"Range", "[", "$n", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"SS", "=", 
  RowBox[{"S", "[", 
   RowBox[{"kk", ",", "$"}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.914543193020899*^9, 3.9145432280571136`*^9}, {
  3.915570575381135*^9, 3.9155705835364532`*^9}},
 CellLabel->"In[32]:=",
 CellID->1092408791,ExpressionUUID->"04fe4b51-eebd-4c6d-9b2b-ad67b8bb0fbe"],

Cell["\<\
Consider a single-qubit unitary gate acting on the target qubit.\
\>", "Text",
 CellChangeTimes->{{3.915561968089419*^9, 3.915561989910396*^9}},
 CellID->1519843333,ExpressionUUID->"6cdc9a68-cb1b-4e9d-bb82-367ee2204d7c"],

Cell[BoxData[{
 RowBox[{"Let", "[", 
  RowBox[{"Real", ",", "\[Phi]"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"opU", "=", 
  RowBox[{"Phase", "[", 
   RowBox[{"\[Phi]", ",", 
    RowBox[{"T", "[", "3", "]"}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.9155619438035088`*^9, 3.915561961969109*^9}, 
   3.915563223592464*^9},
 CellLabel->"In[35]:=",
 CellID->21384525,ExpressionUUID->"20b24218-a1a1-43bb-a79b-491555fb11dd"],

Cell[TextData[{
 "Construct the controlled-power of ",
 StyleBox["opU", "Input"],
 " defined above."
}], "Text",
 CellChangeTimes->{{3.915562001680863*^9, 3.915562037213872*^9}, {
  3.915563228519446*^9, 3.915563229595746*^9}},
 CellID->978050365,ExpressionUUID->"685b26ba-79d1-479b-bf92-b17b982a8d40"],

Cell[BoxData[
 RowBox[{"cop", "=", 
  RowBox[{"ControlledPower", "[", 
   RowBox[{"SS", ",", "opU"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.9145432339155197`*^9, 3.914543467518163*^9}, {
   3.9155619173397837`*^9, 3.915561946672241*^9}, 3.915563252826139*^9},
 CellLabel->"In[37]:=",
 CellID->2127797723,ExpressionUUID->"8766b7ba-33bf-434f-a246-fc2e10fef79e"],

Cell["\<\
Construct a simple quantum circuit to demonstrate how the controlled-power \
gate works.\
\>", "Text",
 CellChangeTimes->{{3.9155621232933674`*^9, 3.91556218666088*^9}},
 CellID->1664622810,ExpressionUUID->"26ff1151-995d-4996-b6e0-ac6d07e66bfd"],

Cell[BoxData[
 RowBox[{"qc", "=", 
  RowBox[{"QuantumCircuit", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ProductState", "[", 
     RowBox[{"T", "->", 
      RowBox[{"{", 
       RowBox[{"1", ",", "1"}], "}"}]}], "]"}], ",", "\[IndentingNewLine]", 
    "cop", ",", "\[IndentingNewLine]", 
    RowBox[{"\"\<Invisible\>\"", "->", 
     RowBox[{"S", "[", 
      RowBox[{"$n", "+", 
       RowBox[{"1", "/", "2"}]}], "]"}]}], ",", "\[IndentingNewLine]", 
    RowBox[{"\"\<PortSize\>\"", "->", 
     RowBox[{"{", 
      RowBox[{"2", ",", "1"}], "}"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.9145432339155197`*^9, 3.914543467518163*^9}, 
   3.9155619173397837`*^9, {3.915562042439109*^9, 3.915562061186548*^9}},
 CellLabel->"In[38]:=",
 CellID->2027335310,ExpressionUUID->"e652e6d9-3ad9-44c2-8aad-de7d5816fb3a"],

Cell["Take computational basis states as inputs.", "Text",
 CellChangeTimes->{{3.915562194162675*^9, 3.915562209826212*^9}},
 CellID->1320057003,ExpressionUUID->"7b102ab9-cfe3-4a04-8642-cce7689e88ee"],

Cell[BoxData[
 RowBox[{"in", "=", 
  RowBox[{"Basis", "[", "SS", "]"}]}]], "Input",
 CellChangeTimes->{{3.914543513049735*^9, 3.914543524666109*^9}, {
  3.915562071121851*^9, 3.915562071922779*^9}},
 CellLabel->"In[39]:=",
 CellID->856233533,ExpressionUUID->"d298b803-4425-457f-bd8f-2c8d31ab3be3"],

Cell["Calculate the output for each input state.", "Text",
 CellChangeTimes->{{3.91556222058533*^9, 3.9155622336700573`*^9}, {
  3.915563342172699*^9, 3.915563342838294*^9}},
 CellID->1095734201,ExpressionUUID->"396072c8-c1ee-4122-9981-c3bf14dc446b"],

Cell[BoxData[
 RowBox[{"out", "=", 
  RowBox[{"qc", "**", "in"}]}]], "Input",
 CellChangeTimes->{{3.914543541969698*^9, 3.914543560936791*^9}, {
  3.91556207394187*^9, 3.915562078618286*^9}, {3.915562215432116*^9, 
  3.91556221690018*^9}},
 CellLabel->"In[40]:=",
 CellID->1234389837,ExpressionUUID->"524d98ce-8554-427e-8576-03bff1451279"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Thread", "[", 
   RowBox[{"in", "->", 
    RowBox[{"KetFactor", "[", "out", "]"}]}], "]"}], "//", 
  "TableForm"}]], "Input",
 CellChangeTimes->{{3.914543541969698*^9, 3.914543560936791*^9}, {
  3.91556207394187*^9, 3.915562078618286*^9}, {3.915562215432116*^9, 
  3.915562248038347*^9}},
 CellLabel->"In[41]:=",
 CellID->273770455,ExpressionUUID->"79d1397f-78e5-4d42-b846-daba90c92d67"]
}, Closed]],

Cell[CellGroupData[{

Cell["More Interesting Example", "Section",
 CellChangeTimes->{{3.914543130530189*^9, 3.914543132793051*^9}, {
  3.914543598042987*^9, 3.914543624341249*^9}},
 CellID->256917172,ExpressionUUID->"b654b2eb-1a69-467c-917f-aab52c8e2cc0"],

Cell["\<\
Construct a simple quantum circuit to demonstrate how the controlled-power \
gate works.\
\>", "Text",
 CellChangeTimes->{{3.9155621232933664`*^9, 3.91556218666088*^9}},
 CellID->523520144,ExpressionUUID->"33e791b0-af00-4c68-9620-397842340db0"],

Cell[BoxData[
 RowBox[{"qc", "=", 
  RowBox[{"QuantumCircuit", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Ket", "[", 
     RowBox[{
      RowBox[{"SS", "->", "0"}], ",", 
      RowBox[{"T", "->", "1"}]}], "]"}], ",", "\[IndentingNewLine]", 
    RowBox[{"S", "[", 
     RowBox[{"kk", ",", "6"}], "]"}], ",", "\"\<Separator\>\"", ",", "cop", 
    ",", "\[IndentingNewLine]", 
    RowBox[{"\"\<Invisible\>\"", "->", 
     RowBox[{"S", "[", 
      RowBox[{"$n", "+", 
       RowBox[{"1", "/", "2"}]}], "]"}]}], ",", "\[IndentingNewLine]", 
    RowBox[{"\"\<PortSize\>\"", "->", 
     RowBox[{"{", 
      RowBox[{"2", ",", "1"}], "}"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.9145432339155197`*^9, 3.914543467518163*^9}, {
   3.9145436439740667`*^9, 3.914543719926654*^9}, 3.914543922335108*^9, 
   3.915562285866394*^9, {3.9155623250620947`*^9, 3.915562346967526*^9}},
 CellLabel->"In[42]:=",
 CellID->770533652,ExpressionUUID->"dc899fb8-d2d7-4745-b54d-a56c709e0944"],

Cell["Calculate the output state.", "Text",
 CellChangeTimes->{{3.915562360365971*^9, 3.915562370869536*^9}},
 CellID->363088131,ExpressionUUID->"ad0245b2-0b39-4e73-8bc3-c488d287f605"],

Cell[BoxData[
 RowBox[{"out", "=", 
  RowBox[{"Elaborate", "[", "qc", "]"}]}]], "Input",
 CellChangeTimes->{{3.91454373652649*^9, 3.9145437398408527`*^9}},
 CellLabel->"In[43]:=",
 CellID->1079016412,ExpressionUUID->"fd53b393-0816-45c4-ab35-98aee706a7a7"],

Cell["Check that the target qubit is factorized.", "Text",
 CellChangeTimes->{{3.915562401501899*^9, 3.915562410394817*^9}},
 CellID->942690207,ExpressionUUID->"fcefa6c1-a621-4f41-820b-9dc980822856"],

Cell[BoxData[
 RowBox[{"KetFactor", "[", 
  RowBox[{"out", ",", "T"}], "]"}]], "Input",
 CellChangeTimes->{{3.914543746907199*^9, 3.914543771737697*^9}},
 CellLabel->"In[44]:=",
 CellID->473086067,ExpressionUUID->"b6c2c9e7-c450-498e-adfd-e006b3e4f00f"],

Cell["\<\
To focus on the state of the control register, ignore the target qubit.\
\>", "Text",
 CellChangeTimes->{{3.915562415648222*^9, 3.915562446861541*^9}},
 CellID->1762048567,ExpressionUUID->"849a904f-9771-432e-92b8-df487936e6ca"],

Cell[BoxData[
 RowBox[{"KetDrop", "[", 
  RowBox[{"out", ",", "T"}], "]"}]], "Input",
 CellChangeTimes->{{3.9145438094804983`*^9, 3.914543813077568*^9}},
 CellLabel->"In[45]:=",
 CellID->1674087129,ExpressionUUID->"57b9f3c8-b8b8-455a-83f6-bfbf28485682"]
}, Closed]],

Cell[CellGroupData[{

Cell["Implementation with Elementary Gates", "Section",
 CellChangeTimes->{{3.9145438593085318`*^9, 3.914543865887855*^9}},
 CellID->55805835,ExpressionUUID->"f766a8f0-5a2b-4700-9cfe-a8bdba179ca9"],

Cell["\<\
Consider again  the quantum circuit for controlled-power gate.\
\>", "Text",
 CellChangeTimes->{{3.91556252986588*^9, 3.915562543392191*^9}, {
  3.915570627304242*^9, 3.915570653279063*^9}},
 CellID->1235189013,ExpressionUUID->"949a14a7-6849-4457-ae9a-1b969392c60e"],

Cell[BoxData[
 RowBox[{"qc", "=", 
  RowBox[{"QuantumCircuit", "[", 
   RowBox[{"cop", ",", 
    RowBox[{"\"\<Invisible\>\"", "->", 
     RowBox[{"S", "[", 
      RowBox[{"$n", "+", 
       RowBox[{"1", "/", "2"}]}], "]"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.914543893693008*^9, 3.914543944114044*^9}, {
  3.9155624900803223`*^9, 3.915562493349232*^9}},
 CellLabel->"In[47]:=",
 CellID->1297582908,ExpressionUUID->"e44a67d4-58ee-429c-a495-cbf370d05470"],

Cell["\<\
Expand the controlled-power gate in terms of elementary gates (in this case, \
the controlled-unitary gates).\
\>", "Text",
 CellChangeTimes->{{3.915562547590307*^9, 3.915562570212177*^9}},
 CellID->331049159,ExpressionUUID->"ec18d277-fb31-4e8e-b9a4-4b007a9b15de"],

Cell[BoxData[
 RowBox[{"new", "=", 
  RowBox[{"Expand", "[", "qc", "]"}]}]], "Input",
 CellChangeTimes->{{3.91454394919066*^9, 3.914543954773894*^9}},
 CellLabel->"In[48]:=",
 CellID->1888208538,ExpressionUUID->"c78e4ce1-0f97-4df1-abbb-3cf236a40ac1"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Matrix", "[", "qc", "]"}], "-", 
   RowBox[{"Matrix", "[", "new", "]"}]}], "//", "MatrixForm"}]], "Input",
 CellChangeTimes->{{3.915562510340214*^9, 3.91556252027286*^9}},
 CellLabel->"In[49]:=",
 CellID->1871953819,ExpressionUUID->"7c779a82-05a2-4c07-9da4-b972f479849e"]
}, Closed]],

Cell[CellGroupData[{

Cell["Summary", "Section",
 CellChangeTimes->{{3.885306034976571*^9, 3.885306035833013*^9}},
 CellID->532058193,ExpressionUUID->"d136961a-1620-4641-a727-4ab2e8af689b"],

Cell[CellGroupData[{

Cell["Keywords", "Subsection",
 CellChangeTimes->{{3.8913962649286203`*^9, 3.8913962658795958`*^9}},
 CellID->1081268205,ExpressionUUID->"e4a404c6-2ae6-4a27-a38e-0c8408374cd2"],

Cell["Controlled-power of unitary operator", "Item",
 CellChangeTimes->{{3.8913962675442877`*^9, 3.891396291621447*^9}, {
  3.892103650451318*^9, 3.89210365383296*^9}, {3.892275217440712*^9, 
  3.892275218295783*^9}, {3.899195098128892*^9, 3.899195098129683*^9}, {
  3.914543992159581*^9, 3.91454400465887*^9}},
 CellID->446936884,ExpressionUUID->"661072ef-62a7-4939-9261-b0f073ee8d02"],

Cell["Controlled-unitary gate", "Item",
 CellChangeTimes->{{3.8913962675442877`*^9, 3.89139631336408*^9}, {
  3.8913963854637737`*^9, 3.89139638904464*^9}, {3.892103672056527*^9, 
  3.892103682174308*^9}, {3.892275229466897*^9, 3.892275233593623*^9}, {
  3.899195092680955*^9, 3.899195095853271*^9}, {3.899197432360555*^9, 
  3.899197432363577*^9}, {3.914544006814553*^9, 3.914544010762083*^9}},
 CellID->2115305517,ExpressionUUID->"29d42cbe-9658-4c04-ae1a-4c2611345537"]
}, Closed]],

Cell[CellGroupData[{

Cell["Functions", "Subsection",
 CellChangeTimes->{{3.885356516796631*^9, 3.885356517785305*^9}},
 CellID->1316731321,ExpressionUUID->"649139cc-815b-40d6-99dd-c679e85b5b54"],

Cell[TextData[StyleBox["ControlledPower", "Input"]], "Item",
 CellChangeTimes->{{3.885356540099222*^9, 3.885356541907227*^9}, {
  3.885400476551014*^9, 3.8854004796405373`*^9}, {3.885536305942862*^9, 
  3.88553630638804*^9}, {3.885587493992428*^9, 3.885587525042856*^9}, {
  3.89139634821424*^9, 3.891396364534376*^9}, {3.892275238128506*^9, 
  3.892275238881791*^9}, {3.914543970875944*^9, 3.914543982085269*^9}},
 CellID->849148097,ExpressionUUID->"58d8e893-100e-4158-a1e3-4a04cac68c90"],

Cell[TextData[StyleBox["ControlledGate", "Input"]], "Item",
 CellChangeTimes->{{3.885356540099222*^9, 3.885356541907227*^9}, {
  3.885400476551014*^9, 3.8854004796405373`*^9}, {3.885536305942862*^9, 
  3.88553630638804*^9}, {3.885587493992428*^9, 3.885587525042856*^9}, {
  3.89139634821424*^9, 3.891396364534376*^9}, {3.892275238128506*^9, 
  3.892275238881791*^9}, {3.914543970875944*^9, 3.914543985021723*^9}},
 CellID->984593265,ExpressionUUID->"32a3f31c-86b5-43cf-a845-e1aa9cfb1720"]
}, Closed]],

Cell[CellGroupData[{

Cell["Related Links", "Subsection",
 CellChangeTimes->{{3.885356807098833*^9, 3.885356809897966*^9}},
 CellID->862852095,ExpressionUUID->"32987d0e-afaa-48a0-ade3-7f268f949558"],

Cell[TextData[{
 "Section 4.3 of the ",
 ButtonBox["Quantum Workbook (2022, 2023)",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["https://link.springer.com/book/10.1007/978-3-030-91214-7"], None}],
 "."
}], "Item",
 CellChangeTimes->{{3.885325833043219*^9, 3.885325887141716*^9}, {
   3.886926286725359*^9, 3.886926288901046*^9}, {3.887421003456878*^9, 
   3.8874210043282623`*^9}, {3.89009766315901*^9, 3.890097697560048*^9}, 
   3.890097745196322*^9, {3.890688755596345*^9, 3.890688755599209*^9}, {
   3.890695444071374*^9, 3.890695444102458*^9}, {3.891396397076474*^9, 
   3.891396397128636*^9}, {3.89227529678895*^9, 3.892275323155737*^9}, {
   3.899197533121516*^9, 3.899197551338177*^9}, {3.9145440203056087`*^9, 
   3.9145440203714647`*^9}},
 CellID->1797404841,ExpressionUUID->"e153c250-e41e-40fe-b743-916c7f7bd4a1"],

Cell[TextData[{
 "Tutorial: ",
 ButtonBox["Quantum Phase Estimation",
  BaseStyle->"Link",
  ButtonData->"paclet:Q3/tutorial/QuantumPhaseEstimation"]
}], "Item",
 CellChangeTimes->{{3.885325833043219*^9, 3.885325887141716*^9}, {
   3.886926286725359*^9, 3.886926288901046*^9}, {3.887421003456878*^9, 
   3.8874210043282623`*^9}, {3.89009766315901*^9, 3.890097697560048*^9}, 
   3.890097745196322*^9, {3.890688755596345*^9, 3.890688755599209*^9}, {
   3.890695444071374*^9, 3.890695444102458*^9}, {3.891396397076474*^9, 
   3.891396397128636*^9}, {3.89227529678895*^9, 3.892275333592763*^9}, {
   3.914544249868424*^9, 3.9145442528634257`*^9}},
 CellID->281874570,ExpressionUUID->"f9667519-8ac7-410a-a8f6-bc28a282c709"]
}, Closed]]
}, Closed]]
}, Open  ]]
},
Saveable->False,
WindowSize->{855, 1041},
WindowMargins->{{131, Automatic}, {Automatic, 0}},
Visible->True,
DockedCells->Cell[
 "Q3: Symbolic Quantum Simulation", "Text", Background -> GrayLevel[0.9], 
  FontSize -> 12, CellFrameMargins -> {{22, 8}, {8, 8}}],
PrintingCopies->1,
PrintingPageRange->{1, Automatic},
PageFooters->{{
   Cell["Q3: Symbolic Quantum Simulation", "Footer", CellMargins -> 4], None, 
   None}, {None, None, 
   Cell["Q3: Symbolic Quantum Simulation", "Footer", CellMargins -> 4]}},
PageFooterLines->{True, True},
FrontEndVersion->"14.0 for Mac OS X ARM (64-bit) (December 12, 2023)",
StyleDefinitions->Notebook[{
   Cell[
    StyleData[StyleDefinitions -> "Playbook.nb"]], 
   Cell[
    StyleData["Title"], Editable -> False], 
   Cell[
    StyleData["Subtitle"], Editable -> False], 
   Cell[
    StyleData["Chapter"], Editable -> False], 
   Cell[
    StyleData["Section"], Editable -> False], 
   Cell[
    StyleData["Subsection"], Editable -> False], 
   Cell[
    StyleData["Subsubsection"], Editable -> False], 
   Cell[
    StyleData["Text"], Editable -> False], 
   Cell[
    StyleData["Code"], Editable -> False], 
   Cell[
    StyleData["Item"], Editable -> False], 
   Cell[
    StyleData["Subitem"], Editable -> False], 
   Cell[
    StyleData["Subsubitem"], Editable -> False], 
   Cell[
    StyleData["DisplayFormula"], Editable -> False], 
   Cell[
    StyleData["Picture"], Editable -> False], 
   Cell[
    StyleData["Caption"], Editable -> False], 
   Cell[
    StyleData["OutlineSection"], Editable -> False], 
   Cell[
    StyleData["Outline1"], Editable -> False], 
   Cell[
    StyleData["Outline2"], Editable -> False], 
   Cell[
    StyleData["Outline3"], Editable -> False], 
   Cell[
    StyleData["Outline4"], Editable -> False]}, Visible -> False, 
  FrontEndVersion -> "14.0 for Mac OS X ARM (64-bit) (December 12, 2023)", 
  StyleDefinitions -> "Playbook.nb"],
ExpressionUUID->"a64d85d3-f4ff-45d1-84ac-a85df45a7494"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 523, 10, 98, "Title",ExpressionUUID->"e4483668-5de3-417a-8cd7-aebbcc4e7409",
 CellID->1984307302],
Cell[1106, 34, 335, 4, 35, "Text",ExpressionUUID->"24eab5e8-b68c-4233-936a-9b37f57105f4",
 CellID->1381245641],
Cell[1444, 40, 303, 5, 35, "Text",ExpressionUUID->"c9f07fa4-664a-4afc-92d9-b3f807628f6e",
 CellID->1422026746],
Cell[1750, 47, 401, 5, 35, "Text",ExpressionUUID->"7e0aaf01-7ef4-4c0f-85e1-6877598ac84f",
 CellID->1339111300],
Cell[2154, 54, 403, 5, 35, "Text",ExpressionUUID->"9228c48e-323f-4f58-a570-5553cbe8867f",
 CellID->1132394223],
Cell[CellGroupData[{
Cell[2582, 63, 218, 3, 67, "Section",ExpressionUUID->"befd37cb-180c-410b-b536-822b7d960c18",
 CellID->3657172],
Cell[2803, 68, 340, 8, 70, "Text",ExpressionUUID->"773fc0f0-05d7-465f-9683-8df09c854ece",
 CellID->307202916],
Cell[CellGroupData[{
Cell[3168, 80, 1008, 33, 70, "Caption",ExpressionUUID->"0583174a-f550-4c6f-aeac-a4c0e03f6fcc",
 CellID->485030944],
Cell[4179, 115, 817, 26, 70, "Caption",ExpressionUUID->"169c502a-5762-43c2-92bb-a57bfecd9a0d",
 CellID->1703606369]
}, Open  ]],
Cell[5011, 144, 4714, 119, 70, "Text",ExpressionUUID->"477ebf39-4d0f-4f6c-bc18-49c0e3f83c65",
 CellID->1046697982],
Cell[9728, 265, 1886, 61, 70, "Caption",ExpressionUUID->"8716361a-3e43-418a-bec3-5a740c0bb627",
 CellID->754200099]
}, Closed]],
Cell[CellGroupData[{
Cell[11651, 331, 272, 4, 53, "Section",ExpressionUUID->"5300a201-7c23-4ffb-83ac-5823c63c4696",
 CellID->1332143281],
Cell[11926, 337, 308, 6, 70, "Input",ExpressionUUID->"6fc1aab9-96b9-46d1-a229-49e33d1e31ed",
 CellID->1535052485],
Cell[12237, 345, 336, 8, 70, "Text",ExpressionUUID->"8107f988-2779-4f9f-8e16-a7ef570fa3af",
 CellID->1475887768],
Cell[12576, 355, 496, 12, 70, "Input",ExpressionUUID->"04fe4b51-eebd-4c6d-9b2b-ad67b8bb0fbe",
 CellID->1092408791],
Cell[13075, 369, 230, 4, 70, "Text",ExpressionUUID->"6cdc9a68-cb1b-4e9d-bb82-367ee2204d7c",
 CellID->1519843333],
Cell[13308, 375, 424, 10, 70, "Input",ExpressionUUID->"20b24218-a1a1-43bb-a79b-491555fb11dd",
 CellID->21384525],
Cell[13735, 387, 302, 7, 70, "Text",ExpressionUUID->"685b26ba-79d1-479b-bf92-b17b982a8d40",
 CellID->978050365],
Cell[14040, 396, 362, 7, 70, "Input",ExpressionUUID->"8766b7ba-33bf-434f-a246-fc2e10fef79e",
 CellID->2127797723],
Cell[14405, 405, 255, 5, 70, "Text",ExpressionUUID->"26ff1151-995d-4996-b6e0-ac6d07e66bfd",
 CellID->1664622810],
Cell[14663, 412, 849, 20, 70, "Input",ExpressionUUID->"e652e6d9-3ad9-44c2-8aad-de7d5816fb3a",
 CellID->2027335310],
Cell[15515, 434, 200, 2, 70, "Text",ExpressionUUID->"7b102ab9-cfe3-4a04-8642-cce7689e88ee",
 CellID->1320057003],
Cell[15718, 438, 297, 6, 70, "Input",ExpressionUUID->"d298b803-4425-457f-bd8f-2c8d31ab3be3",
 CellID->856233533],
Cell[16018, 446, 250, 3, 70, "Text",ExpressionUUID->"396072c8-c1ee-4122-9981-c3bf14dc446b",
 CellID->1095734201],
Cell[16271, 451, 339, 7, 70, "Input",ExpressionUUID->"524d98ce-8554-427e-8576-03bff1451279",
 CellID->1234389837],
Cell[16613, 460, 422, 10, 70, "Input",ExpressionUUID->"79d1397f-78e5-4d42-b846-daba90c92d67",
 CellID->273770455]
}, Closed]],
Cell[CellGroupData[{
Cell[17072, 475, 233, 3, 53, "Section",ExpressionUUID->"b654b2eb-1a69-467c-917f-aab52c8e2cc0",
 CellID->256917172],
Cell[17308, 480, 254, 5, 70, "Text",ExpressionUUID->"33e791b0-af00-4c68-9620-397842340db0",
 CellID->523520144],
Cell[17565, 487, 1007, 23, 70, "Input",ExpressionUUID->"dc899fb8-d2d7-4745-b54d-a56c709e0944",
 CellID->770533652],
Cell[18575, 512, 184, 2, 70, "Text",ExpressionUUID->"ad0245b2-0b39-4e73-8bc3-c488d287f605",
 CellID->363088131],
Cell[18762, 516, 255, 5, 70, "Input",ExpressionUUID->"fd53b393-0816-45c4-ab35-98aee706a7a7",
 CellID->1079016412],
Cell[19020, 523, 199, 2, 70, "Text",ExpressionUUID->"fcefa6c1-a621-4f41-820b-9dc980822856",
 CellID->942690207],
Cell[19222, 527, 252, 5, 70, "Input",ExpressionUUID->"b6c2c9e7-c450-498e-adfd-e006b3e4f00f",
 CellID->473086067],
Cell[19477, 534, 237, 4, 70, "Text",ExpressionUUID->"849a904f-9771-432e-92b8-df487936e6ca",
 CellID->1762048567],
Cell[19717, 540, 253, 5, 70, "Input",ExpressionUUID->"57b9f3c8-b8b8-455a-83f6-bfbf28485682",
 CellID->1674087129]
}, Closed]],
Cell[CellGroupData[{
Cell[20007, 550, 197, 2, 53, "Section",ExpressionUUID->"f766a8f0-5a2b-4700-9cfe-a8bdba179ca9",
 CellID->55805835],
Cell[20207, 554, 276, 5, 70, "Text",ExpressionUUID->"949a14a7-6849-4457-ae9a-1b969392c60e",
 CellID->1235189013],
Cell[20486, 561, 463, 11, 70, "Input",ExpressionUUID->"e44a67d4-58ee-429c-a495-cbf370d05470",
 CellID->1297582908],
Cell[20952, 574, 274, 5, 70, "Text",ExpressionUUID->"ec18d277-fb31-4e8e-b9a4-4b007a9b15de",
 CellID->331049159],
Cell[21229, 581, 250, 5, 70, "Input",ExpressionUUID->"c78e4ce1-0f97-4df1-abbb-3cf236a40ac1",
 CellID->1888208538],
Cell[21482, 588, 318, 7, 70, "Input",ExpressionUUID->"7c779a82-05a2-4c07-9da4-b972f479849e",
 CellID->1871953819]
}, Closed]],
Cell[CellGroupData[{
Cell[21837, 600, 167, 2, 53, "Section",ExpressionUUID->"d136961a-1620-4641-a727-4ab2e8af689b",
 CellID->532058193],
Cell[CellGroupData[{
Cell[22029, 606, 176, 2, 70, "Subsection",ExpressionUUID->"e4a404c6-2ae6-4a27-a38e-0c8408374cd2",
 CellID->1081268205],
Cell[22208, 610, 386, 5, 70, "Item",ExpressionUUID->"661072ef-62a7-4939-9261-b0f073ee8d02",
 CellID->446936884],
Cell[22597, 617, 471, 6, 70, "Item",ExpressionUUID->"29d42cbe-9658-4c04-ae1a-4c2611345537",
 CellID->2115305517]
}, Closed]],
Cell[CellGroupData[{
Cell[23105, 628, 173, 2, 70, "Subsection",ExpressionUUID->"649139cc-815b-40d6-99dd-c679e85b5b54",
 CellID->1316731321],
Cell[23281, 632, 489, 6, 70, "Item",ExpressionUUID->"58d8e893-100e-4158-a1e3-4a04cac68c90",
 CellID->849148097],
Cell[23773, 640, 488, 6, 70, "Item",ExpressionUUID->"32a3f31c-86b5-43cf-a845-e1aa9cfb1720",
 CellID->984593265]
}, Closed]],
Cell[CellGroupData[{
Cell[24298, 651, 176, 2, 70, "Subsection",ExpressionUUID->"32987d0e-afaa-48a0-ade3-7f268f949558",
 CellID->862852095],
Cell[24477, 655, 829, 16, 70, "Item",ExpressionUUID->"e153c250-e41e-40fe-b743-916c7f7bd4a1",
 CellID->1797404841],
Cell[25309, 673, 718, 13, 70, "Item",ExpressionUUID->"f9667519-8ac7-410a-a8f6-bc28a282c709",
 CellID->281874570]
}, Closed]]
}, Closed]]
}, Open  ]]
}
]
*)

